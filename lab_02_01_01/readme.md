# __Отчёт по лабораторной работе №2 "Запись с вариантами, обрабобтка таблиц", Вариант 1__
----

## Выполнил: Калашков Павел ИУ7-36Б, Вариант 7 (по журналу)

[0. Описание условия задачи](#описание-условия-задачи)

[1. Техническое задание](#техническое-задание)

[1.1. Исходные данные](#исходные-данные)

[1.2. Результаты](#результаты)

[1.3. Задача, реализуемая программой](#задача-реализуемая-программой)

[1.4. Способ обращения к программе](#способ-обращения-к-программе)

[1.5. Возможные аварийные ситуации и ошибки пользователя](#возможные-аварийные-ситуации-и-ошибки-пользователя)

[2. Описание внутренних структур данных](#описание-внутренних-структур-данных)

[3. Описанный алгоритм](#описанный-алгоритм)

[3.1. Чтение данных и проверка их корректности](#чтение-данных-и-проверка-их-корректности)

[3.2. Обработка данных (деление)](#обработка-данных-деление)

[3.3. Вывод результата в нормальном виде](#вывод-результата-в-нормальном-виде)

[4. Функциональное тестирование](#функциональное-тестирование)

[5. Теоретическая часть](#теоретическая-часть)

[6. Выводы по проделанной работе](#выводы-по-проделанной-работе)

## __Описание условия задачи__

Цель работы - приобрести навыки работы с типом данных «запись» («структура») содержащим
вариантную часть, и с данными, хранящимися в таблицах. Оценить относительную эффективность
программы (в процентах) по времени и по используемому объему памяти в зависимости от
используемого алгоритма и от объема сортируемой информации.

Создать таблицу, содержащую не менее 40-ка записей (тип
– запись с вариантами (объединениями)). Упорядочить
данные в ней по возрастанию ключей, двумя алгоритмами
сортировки, где ключ – любое невариантное поле (по
выбору программиста), используя: а) саму таблицу, б)
массив ключей. (Возможность добавления и удаления
записей в ручном режиме обязательна).

Ввести список литературы, содержащий фамилию автора,
название книги, издательство, количество страниц, вид
литературы (1: техническая – отрасль, отечественная,
переводная, год издания; 2: художественная – роман, пьеса,
стихи; 3: детская – сказки, стихи). Вывести список
отечественной технической литературы по указанной отрасли
указанного года.

## __Техническое задание__

### __Исходные данные__

Исходными данными для программы является:

- 1 - файл с входными данными, содержащий поля структур;
- 2 - данные, введённые с консоли (см. ниже);

Файл с входными данными содержит в себе данные о полях элемента. При этом:

- 1 - каждое поле содержится в своей строке, не содержит пробельных символов в начале или в конце;
- 2 - содержимое строк состоит из стандартного набора символов таблицы ASCII (т.е. символы русского алфавита невалидны);
- 3 - для указания вариантных полей структуры есть строгий формат ввода:
```bash
Тип книги:
    Техническая - "Technical";
    Художественная - "Fiction";
    Детская - "Children's";
Для технической книги:
    Отрасль -  указывается строкой;
    Отечественная или нет- "National" или "Foreign";
    Переводная или нет - "Translated" или "Untranslated";
    Год публикации - натуральное число;
Для художественной книги:
    Роман или нет - "Novel" или "Not novel";
    Пьеса или нет - "Play" или "Not play";
    Стихи или нет - "Poetry" или "Prose";
Для детской книги:
    Сказки или нет - "Tales" или "Not tales";
    Стихи или нет - "Children's poetry" или "Children's prose";
```
- 4 - длина каждой строки ограничена соответствующей константой:
```bash
Максимальное количество элементов: 200
Максимальная длина названия: 20
Максимальная длина навзания исходного файла: 40
Максимальная длина названия файла с результатом: 40
Максимальная длина отрасли технической книги: 20
```

Данные, введённые с консоли, связаны с меню программы:
```bash
Возможные действия:
 1 - Вывести список литературы
 2 - Прочитать список литературы
 3 - Добавить запись
 4 - Удалить запись
 5 - Поиск технической литературы по отрасли и году
 6 - Удалить все записи
 7 - Упорядочить по количеству страниц
 8 - Настроить файлы ввода и вывода
 9 - Посмотреть текущие параметры программы
 0 - Выйти из программы
Введите номер действия:
```
Поэтому введённые данные являются **строкой**, которая может содержать в себе:
- 1 - номер действия;
- 2 - поле элемента (для действий 3, 4, 5);
- 3 - имя файла (для действия 8);

### __Результаты__

Выходными данными являются:
- 1 - файл с результирующими даннными;
- 2 - данные в консоли (см. ниже);

Файл с результирующими даннными содержит таблицу из упорядоченных элементов типа book (см. ниже);
При этом:
- если таблица пустая, то файл содержит только заголовок таблицы;
- данные упорядочены либо по количеству страниц, либо так, как они лежат во входном файле;

Данными в консоли являются:
- ответ программы на команду (сообщение об успешном / неуспешном выполнении, результаты действия команды);
- меню программы;

### __Задача, реализуемая программой__

Задачей программы является реализация операций со структурами с вариантной частью (тип структуры см. ниже); 
При этом программа должна уметь:
- 1 - Вывести список литературы
- 2 - Прочитать список литературы
- 3 - Добавить запись
- 4 - Удалить запись
- 5 - Поиск технической литературы по отрасли и году
- 6 - Удалить все записи
- 7 - Упорядочить по количеству страниц
- 8 - Настроить файлы ввода и вывода
- 9 - Посмотреть текущие параметры программы

### __Способ обращения к программе__

Обращение к программе происходит посредством запуска исполняемого файла app.exe

### __Возможные аварийные ситуации и ошибки пользователя__

Аварийной ситуацией является:

- несоблюдение формата входных данных (см. [исходные данные](#исходные-данные));
- указание несуществующего файла как исходного;

-------

## __Описание внутренних структур данных__

Для реализации деления и обработки больших чисел были реализованы две структуры данных:

```c
typedef struct
{
    char title[TITLE_MAX_LENGTH + 1]; // название книги
    char publishing_house[PUBLISHER_MAX_LENGTH + 1]; // издательство
    int pages; // количество страниц
    short state; // Тип книги: 0 - техническая, 1 - художественная, 2 - детская
    union 
    {
        struct
        {
            char sector[SECTOR_MAX_LENGTH]; // название отрасли
            int is_local; // отечественная или нет
            int is_translated; // переводная или нет
            int year_of_publication; // год выпуска
        } technical;
        struct
        {
            int is_novel; // роман или нет
            int is_play; // пьеса или нет
            int is_poetry; // стихи или нет
        } fiction;
        struct
        {
            int is_tales; // сказки или нет
            int is_poetry; // стихи или нет
        } childrens;
    } type;
} book;

typedef struct
{
    int index; // индекс элемента
    int pages; // количество страниц
} key;
```

Данные структуры используются для обработки и хранения чисел, выходящих за разрядную сетку персонального комьютера.

## __Описанный алгоритм__

Алгоритм делится на четыре главных части:

- 1 - вывод меню;
- 2 - запрос действия из меню;
- 3 - выполнение действия (если оно указано корректно);
- 4 - повтор, если действие - не выход из программы;

### __Вывод меню__

Меню имеет формат:
```bash
Возможные действия:
 1 - Вывести список литературы
 2 - Прочитать список литературы
 3 - Добавить запись
 4 - Удалить запись
 5 - Поиск технической литературы по отрасли и году
 6 - Удалить все записи
 7 - Упорядочить по количеству страниц
 8 - Настроить файлы ввода и вывода
 9 - Посмотреть текущие параметры программы
 0 - Выйти из программы
Введите номер действия: 
```

### __Запрос действия из меню__

Программа запрашивает номер действия как строку, считывает и проверяет на корректность. 

Если корректно, то переводит строку в число, иначе выводит сообщение об ошибке.

### __Выполнение действия__

- 1 - Вывести список литературы: в указанный файл с результирующими данными (по умолчанию dst.txt) выводится таблица с литературой;
- 2 - Прочитать список литературы: из указанного файла с исходными даннными (по умолчанию src.txt) читаем структуры во внутренний массив;
- 3 - Добавить запись: запросить данные про новый элемент из консоли, добавить в конец;
- 4 - Удалить запись: запросить название удаляемого элемента, удалить первый из элементов с таким названием, если он есть;
- 5 - Поиск технической литературы по отрасли и году: запросить отрасль и год, вывести в консоль данные об элементах с такими отраслями и годами;
- 6 - Удалить все записи: удалить все данные из внутреннего массива;
- 7 - Упорядочить по количеству страниц:

Упорядочить записи по количество страниц при помощи выбранного пользователем способа (используя доп. таблицу ключей или нет), а также при помощи выбранного пользователем алгоритма (сортировка вставками или быстрая сортировка).

Также должна быть возможность замерить и сравнить время работы и объём используемой памяти при использовании доп. таблицы ключей и без неё (при помощи выбранного пользователем алгоритма);

- 8 - Настроить файлы ввода и вывода: поменять названия для файлов ввода и вывода;
- 9 - Посмотреть текущие параметры программы: вывести данные о названиях файлов ввода и вывода и о внутренних ограничениях;
- 0 - Выйти из программы: вывести сообщение о завершении программы;

## __Сравнение алгоритмов__

Сравним время работы и объём используемой памяти для используемых алгоритмов при количестве записей равном N. 

|N|Без ключей, insection, мкс|Без ключей, quicksort, мкс|Объём памяти без ключей, байты|С ключами, insection, мкс|С ключами, quicksort, мкс|Объём памяти с ключами, байты|
|:--|----------------------|--------------------------|------------------------------|-------------------------|-------------------------|-----------------------------|
|10|1|9|800|1|1|880|
|20|4|10|1600|1|2|1760|
|30|6|10|2400|3|2|2640|
|40|8|12|3200|3|3|3520|
|50|16|12|4000|7|3|4400|
|100|57|19|8000|22|8|8800|
|200|217|31|16000|79|18|17600|

Видим, что использование дополнительного массива ключей помогает значительно уменьшить время работы алгоритма, при этом не так значительно увеличивая затраты по памяти. Так, в среднем мы получаем прирост 300% к скорости, увеличивая используемый объём памяти на 10%.

## __Теоретическая часть__

1. Как выделяется память под вариантную часть записи?

В языке C вариантная часть записи реализуется при помощи объединения (union). Выделяется память размером под наибольшую из вариантных полей записи. Таким образом, есть место для операции с любыми из вариантных полей.

2. Что будет, если в вариантную часть ввести данные, несоответствующие описанным?

Ничего, транслятор не отслеживает тип данных, который заносится в вариантную часть, что может привести к ошибкам, если за этим не следить.

3. Кто должен следить за правильностью выполнения операций с вариантной частью?

Программист и только он.

4. Что представляет собой таблица ключей, зачем она нужна?

Таблица ключей - дополнительная таблица, содержащая индекс элемента в исходной таблице и значение ключевого поля. Таким образом, таблица ключей экономит время обработки основной таблицы.

5. В каких случаях эффективнее обрабатывать данные в самой таблице, а когда - исползовать таблицу ключей?

Обрабатывать данные эффективнее при малых размерах таблицы или при малом размере используемых структур. В ином случае будет эффективнее использовать таблицу ключей.

6. Какие способы сортировки предпочтительнее для обработки таблиц и почему?

Предпочтительнее использовать устойчивые методы сортировки, т.е. те, которые не переставляют уже отсортированные элементы. Например, сортировка вставками или пузырьком с флагом.

## __Выводы по проделанной работе__

В случае, когда требуется обрабатывать записи с вариантными полями, следует использовать совокупность структур и объединений (struct + union). При этом обрабатывать таблицу с такими записями чаще всего удобнее при помощи дополнительной таблицы ключей (если размер таблицы или используемой структуры велик), а сортировать при помощи устойчивых сортировок.
